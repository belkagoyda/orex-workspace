<!DOCTYPE html>
<html>
<head>
    <title>OREX - {{ table_name }}</title>
    <style>
        table, th, td {
            border: 1px solid black;
            padding: 5px;
        }
        table {
            table-layout: fixed;
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        th {
            position: relative;
            cursor: col-resize;
            background-color: #f0f0f0;
        }
        th::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 100%;
            background: rgba(0,0,0,0.1);
            cursor: col-resize;
        }
    </style>
</head>
<body>
    <h1>Таблица: {{ table_name }}</h1>
    <button onclick="window.print()">Печать</button>
    
    <table id="resizeTable">
        <thead>
            <tr>
                {% for column in columns %}
                    <th>{{ column }}</th>
                {% endfor %}
                <th>Действие</th>
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
            <tr>
                {% for column in columns %}
                    <td title="{{ row[column] }}">{{ row[column] }}</td>
                {% endfor %}
                <td>
                    <form method="POST">
                        <input type="hidden" name="row_id" value="{{ row[primary_key] }}">
                        <button type="submit">Сгенерировать ответ</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <a href="{{ url_for('base') }}">Назад</a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const table = document.getElementById('resizeTable');
            const thElements = table.querySelectorAll('thead th');
            let startX, startWidth;
            
            // Установка начальных размеров колонок
            thElements.forEach(th => {
                th.style.width = (100 / thElements.length) + '%';
            });
            
            // Обработчики изменения размера
            thElements.forEach(th => {
                th.addEventListener('mousedown', e => {
                    if (e.offsetX > th.offsetWidth - 15) {
                        startX = e.clientX;
                        startWidth = th.offsetWidth;
                        document.documentElement.style.cursor = 'col-resize';
                        document.documentElement.style.userSelect = 'none';
                        
                        document.addEventListener('mousemove', doResize);
                        document.addEventListener('mouseup', stopResize);
                    }
                });
            });
            
            function doResize(e) {
                const newWidth = startWidth + (e.clientX - startX);
                thElements.forEach(th => {
                    if (th.contains(document.elementFromPoint(e.clientX, 10))) {
                        th.style.width = Math.max(30, newWidth) + 'px';
                    }
                });
            }
            
            function stopResize() {
                document.documentElement.style.cursor = '';
                document.documentElement.style.userSelect = '';
                document.removeEventListener('mousemove', doResize);
                document.removeEventListener('mouseup', stopResize);
            }
        });
    </script>
</body>
</html>